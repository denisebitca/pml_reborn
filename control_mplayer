#!/bin/bash

# LD_LIBRARY_PATH for xdotool
export LD_LIBRARY_PATH=$PWD/lib

# PATH for ease of writing
export PATH=$PATH:$PWD/bin

MEDIA_URL=$1
echo pause &> /tmp/mplay_ft_lock
echo loadfile $MEDIA_URL &> /tmp/mplay_ft_lock
echo hide &> /tmp/mplay_ft_lock
echo vo_ontop 1 &> /tmp/mplay_ft_lock
echo loop 100000000 &> /tmp/mplay_ft_lock
while true
do
    windows=$(xwininfo -name "pml_reborn" 2>&1)
    if [[ "$windows" != "xwininfo: error: No window with name \"pml_reborn\" exists!" ]];
    then
		sleep 2
		xdotool set_window --overrideredirect 1 $(xdotool search --name "pml_reborn")
		xdotool windowunmap $(xdotool search --name "pml_reborn")
		xdotool windowmap $(xdotool search --name "pml_reborn")
		echo seek 0 2 &> /tmp/mplay_ft_lock
        break
    fi
    # delay until next loop iteration
done
